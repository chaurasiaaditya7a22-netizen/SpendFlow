name: Build Android APK

on: push

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install required system packages
        run: |
          sudo apt-get update
          sudo apt-get install -y zip unzip libstdc++6 python3-pip

      - name: Install Android SDK + build-tools
        run: |
          sudo mkdir -p /usr/lib/android-sdk
          sudo bash -c "yes | sdkmanager --licenses"
          sudo sdkmanager --install \
            'platform-tools' \
            'platforms;android-33' \
            'build-tools;33.0.2'

      - name: Install Buildozer
        run: pip3 install buildozer cython

      - name: Build APK
        run: |
          cd android
          buildozer android debug

      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: SpendFlow-APK
          path: android/bin/*.apk
